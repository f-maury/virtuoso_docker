version: '3.7'

services:
  nginx:
    image: nginx:1.21-alpine
    container_name: nginx
    depends_on:
      - php-fpm
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # your vhost
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      # your website sources
      - ./website:/var/www/html:ro
      # SSL certs (host â†’ container)
      - /etc/dsissl/auto/makaao.paris.inria.fr/fullchain.pem:/etc/ssl/makaao/fullchain.pem:ro
      - /etc/dsissl/auto/makaao.paris.inria.fr/privkey.pem:/etc/ssl/makaao/privkey.pem:ro
      - /etc/dsissl/auto/makaao.paris.inria.fr/chain.pem:/etc/ssl/makaao/chain.pem:ro

  php-fpm:
    image: php:8.0-fpm-alpine
    container_name: php-fpm
    volumes:
      - ./website:/var/www/html:ro

  scheduler:
    build:
      context: .
      dockerfile: Dockerfile.scheduler
    container_name: updater-cron
    restart: unless-stopped
    volumes:
      - ./website/data:/data
